# Docker Compose configuration for VPS deployment
# Compatible with docker-compose 1.17.1
# 
# Usage:
#   1. Copy this file to your VPS as docker-compose.yml
#   2. Create a .env file with your configuration (see .env.vps.example)
#   3. Run: docker-compose pull && docker-compose up -d
#
# To run CLI commands (one-off):
#   docker run --rm -it \
#     -e OPENCLAW_GATEWAY_TOKEN=$OPENCLAW_GATEWAY_TOKEN \
#     -v openclaw_openclaw-config:/home/node/.openclaw \
#     ghcr.io/cctry/openclaw:latest agent --message "hello"
#
# The image is automatically built and pushed to GHCR by GitHub Actions
# on every push to main and when tags are created.

version: '3.3'

services:
  openclaw-gateway:
    image: ghcr.io/cctry/openclaw:latest
    container_name: openclaw-gateway
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
      CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY}
      CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY}
      CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE}
    volumes:
      - openclaw-config:/home/node/.openclaw
      - openclaw-workspace:/home/node/.openclaw/workspace
    ports:
      - "127.0.0.1:${OPENCLAW_GATEWAY_PORT:-18789}:18789"
      - "127.0.0.1:${OPENCLAW_BRIDGE_PORT:-18790}:18790"
    restart: unless-stopped
    command:
      - node
      - openclaw.mjs
      - gateway
      - --bind
      - ${OPENCLAW_GATEWAY_BIND:-lan}
      - --port
      - "18789"

volumes:
  openclaw-config:
    driver: local
  openclaw-workspace:
    driver: local
